# MEM-006: Implement SQLAlchemy ORM Models

**State:** COMPLETED
**Priority:** P0
**Type:** Story
**Component:** memory-system
**Sprint:** 1
**Effort:** 5 SP

## Description

Create SQLAlchemy models matching database schema with async support

## Acceptance Criteria

- [x] StageMemoryModel with JSONB for raw_memory_refs
- [x] TaskContextModel with foreign key to stage_memories
- [x] ErrorModel with error_type constraint validation
- [x] CompressionMetricsModel for cost tracking
- [x] All models use AsyncSession
- [x] Relationships configured (task → stages → memories)

## Dependencies

- #MEM-001 (parent epic)
- #MEM-005

## Context

**Specs:** docs/specs/memory-service/spec.md (Hybrid: Mem0 + COMPASS + Graph)
**Plans:** docs/specs/memory-service/plan.md
**Tasks:** docs/specs/memory-service/tasks.md

## Effort

**Story Points:** 5
**Sprint:** 1 (of 4 sprints, 8 weeks total)

## Progress

**Implementation Notes:**

- Created `src/agentcore/a2a_protocol/database/memory_models.py` with all ORM models
- Implemented MemoryModel with full COMPASS fields (stage_id, is_critical, actions, etc.)
- Implemented StageMemoryModel with JSONB quality_metrics and raw_memory_refs
- Implemented TaskContextModel with JSONB performance_metrics
- Implemented ErrorModel with CheckConstraint for error_severity (0.0-1.0)
- Implemented CompressionMetricsModel for cost tracking
- All models use Mapped[T] and mapped_column for SQLAlchemy 2.0 async support
- Added to_pydantic() methods for ORM→Pydantic conversion
- Added __repr__() methods for debugging
- Configured composite indexes matching migration
- Created comprehensive unit tests (21 tests, 100% passing)
- Tests verify model structure, Pydantic conversion, and __repr__ methods

**Files Created:**

- `src/agentcore/a2a_protocol/database/memory_models.py` (465 lines)
- `tests/unit/database/test_memory_orm_models.py` (450 lines)

**Files Modified:**

- `.sage/tickets/MEM-006.md` (updated status to COMPLETED)

---

*Created: 2025-11-05T22:39:04.223165+00:00*
*Updated: 2025-11-14T22:45:00.000000+00:00*
*Completed: 2025-11-14T22:45:00.000000+00:00*
