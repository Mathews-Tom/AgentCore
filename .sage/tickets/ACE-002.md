# ACE-002: Create COMPASS-Enhanced Database Migration

**State:** UNPROCESSED
**Priority:** P0
**Type:** Story
**Sprint:** Sprint 1 (Week 1-2)
**Effort:** 8 story points

## Description

Implement Alembic migration for 6 ACE tables including TimescaleDB hypertable for performance metrics

**Phase:** Phase 1: Foundation + Original ACE Core

## Acceptance Criteria

- [ ] TimescaleDB extension added to PostgreSQL
- [ ] All 6 tables created (context_playbooks, playbook_deltas, delta_approvals, performance_metrics, intervention_history, capability_evaluations)
- [ ] TimescaleDB hypertable configured for performance_metrics (time-series optimized)
- [ ] Composite indexes on (agent_id, task_id, stage) for metrics queries
- [ ] GIN index on playbook_deltas.delta_content (JSONB)
- [ ] Migration reversible (downgrade tested)

## Dependencies

- Parent: ACE-001 (ACE Integration Epic)
- Depends on: ACE-001

## Technical Details

**Owner:** Backend Engineer

**Files to modify/create:**
  - `alembic/versions/XXX_add_ace_tables.py`
  - `docker-compose.dev.yml` (add TimescaleDB extension)

**Estimated Duration:** 8 story points (~3-4 days)

## Testing Requirements

- Unit tests for migration (90%+ coverage)
- Integration tests for schema validation
- Migration up/down path testing
- TimescaleDB hypertable verification

## Context

- **Specification:** [docs/specs/ace-integration/spec.md](../../docs/specs/ace-integration/spec.md)
- **Implementation Plan:** [docs/specs/ace-integration/plan.md](../../docs/specs/ace-integration/plan.md)
- **Task Breakdown:** [docs/specs/ace-integration/tasks.md](../../docs/specs/ace-integration/tasks.md)
- **Epic Ticket:** [ACE-001](.sage/tickets/ACE-001.md)

## Notes

This task is part of the COMPASS-enhanced ACE implementation, targeting:
- +20% long-horizon task accuracy
- 90%+ critical error recall
- 85%+ intervention precision
- <200ms ACE-MEM coordination latency
- <5% system overhead
