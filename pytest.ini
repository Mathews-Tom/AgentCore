[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Coverage settings
addopts =
    --cov=src/agentcore/a2a_protocol
    --cov=src/agentcore/agent_runtime
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=85
    -v
    --tb=short

# Markers
markers =
    integration: Integration tests
    unit: Unit tests
    slow: Slow running tests
    load: Load tests
    performance: Performance tests (measure latency, throughput, resource usage)
    stress: Stress tests (high load, edge cases, resource exhaustion)
    endurance: Endurance tests (long-running stability tests)
    microbenchmark: Micro-benchmark tests for granular performance measurement
    gpu: Tests requiring GPU hardware (CUDA/ROCm) - skip on CPU-only systems

# Ignore patterns
norecursedirs = .git .tox dist build *.egg .venv venv

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Filter warnings
filterwarnings =
    # Testcontainers deprecation (internal)
    ignore:The @wait_container_is_ready decorator is deprecated:DeprecationWarning:testcontainers
    # Google Protobuf Python 3.14 forward-compatibility warnings (external library)
    ignore:Type google._upb._message.*MapContainer uses PyType_Spec:DeprecationWarning
    # OpenTelemetry pkg_resources deprecation warnings (external library)
    ignore:pkg_resources is deprecated as an API:UserWarning:opentelemetry.instrumentation.dependencies
    ignore:Deprecated call to.*pkg_resources.declare_namespace:DeprecationWarning:pkg_resources
    # Pydantic datetime.utcnow() deprecation (external library - Pydantic v2.12)
    ignore:datetime.datetime.utcnow\(\) is deprecated:DeprecationWarning:pydantic.main
    # SciPy precision loss warnings (expected with near-identical test data)
    ignore:Precision loss occurred in moment calculation:RuntimeWarning:scipy.stats._axis_nan_policy
    # Litellm Pydantic v1 compatibility warnings (external library)
    ignore:Support for class-based `config` is deprecated:DeprecationWarning:litellm.proxy._types
    # Litellm importlib.resources deprecation (external library)
    ignore:open_text is deprecated.*Use files\(\) instead:DeprecationWarning:litellm.utils
    # Async subprocess cleanup warnings (test cleanup - not production code)
    ignore:Exception ignored in.*BaseSubprocessTransport.__del__:pytest.PytestUnraisableExceptionWarning
    ignore:coroutine.*was never awaited:RuntimeWarning